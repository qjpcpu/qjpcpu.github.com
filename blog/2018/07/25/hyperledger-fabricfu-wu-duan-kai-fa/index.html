
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>hyperledger-fabric服务端开发 - Jason's space</title>
	<meta name="author" content="Jason">

	
	<meta name="description" content="这篇文章并不是介绍fabric智能合约怎么编写的,因为这类的文章随便在google上一搜一大把. 但反而是fabric服务端开发应该怎么做需要有人稍稍点拨一下。本文就以golang服务端为例，介绍一下fabric服务端基本做法。 fabric-sdk-go 准备基础配置文件 初始化sdk &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113796486-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113796486-1');
</script>

</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Jason's space</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/blog/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/blog/categories">Categories</a></li>
	<li><a href="/about">About</a></li>
</ul>

</nav>
<!--
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/blog/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/blog/categories">Categories</a></li>
	<li><a href="/about">About</a></li>
</ul>

</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:qjpcpu.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="/search.html" method="get">
		<input class="search" type="text" name="query" x-webkit-speech/>
	</form>
</nav>
-->

</header>
	
		
	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Hyperledger-fabric服务端开发</h2>
	<div class="entry-content"><p>这篇文章并不是介绍fabric智能合约怎么编写的,因为这类的文章随便在google上一搜一大把. 但反而是fabric服务端开发应该怎么做需要有人稍稍点拨一下。本文就以golang服务端为例，介绍一下fabric服务端基本做法。</p>

<!-- more -->

<ul id="markdown-toc">
  <li><a href="#fabric-sdk-go">fabric-sdk-go</a></li>
  <li><a href="#section">准备基础配置文件</a></li>
  <li><a href="#sdk">初始化sdk</a></li>
  <li><a href="#section-1">初始化通道</a></li>
  <li><a href="#chaincode">操作ChainCode</a></li>
  <li><a href="#section-2">完整示例</a></li>
  <li><a href="#section-3">其他官方示例</a></li>
</ul>

<h1 id="fabric-sdk-go">fabric-sdk-go</h1>

<p>fabric目前主要提供了<code>node</code>和<code>go</code>的SDK，我们将以<a href="https://github.com/hyperledger/fabric-sdk-go">fabric-sdk-go</a>为例搭建一个简单服务端程序。</p>

<p>首先安装fabric开发基础库:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">go get -u github.com/hyperledger/fabric/orderer
</span><span class="line">go get -u github.com/hyperledger/fabric/peer
</span><span class="line">go get -u github.com/hyperledger/fabric-sdk-go
</span><span class="line">
</span><span class="line"><span class="c"># Optional - populate vendor directory (if needed by your downstream vendoring solution)</span>
</span><span class="line"><span class="c"># cd $GOPATH/src/github.com/hyperledger/fabric-sdk-go/</span>
</span><span class="line"><span class="c"># make populate</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="section">准备基础配置文件</h1>

<p>首先准备一份客户端连接的配置文件，配置连接orderer、peer节点，证书路径等信息:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>config_e2e.yaml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
<span class="line-number">191</span>
<span class="line-number">192</span>
<span class="line-number">193</span>
<span class="line-number">194</span>
<span class="line-number">195</span>
<span class="line-number">196</span>
<span class="line-number">197</span>
<span class="line-number">198</span>
<span class="line-number">199</span>
<span class="line-number">200</span>
<span class="line-number">201</span>
<span class="line-number">202</span>
<span class="line-number">203</span>
<span class="line-number">204</span>
<span class="line-number">205</span>
<span class="line-number">206</span>
<span class="line-number">207</span>
<span class="line-number">208</span>
<span class="line-number">209</span>
<span class="line-number">210</span>
<span class="line-number">211</span>
<span class="line-number">212</span>
<span class="line-number">213</span>
<span class="line-number">214</span>
<span class="line-number">215</span>
<span class="line-number">216</span>
<span class="line-number">217</span>
<span class="line-number">218</span>
<span class="line-number">219</span>
<span class="line-number">220</span>
<span class="line-number">221</span>
<span class="line-number">222</span>
<span class="line-number">223</span>
<span class="line-number">224</span>
<span class="line-number">225</span>
<span class="line-number">226</span>
<span class="line-number">227</span>
<span class="line-number">228</span>
<span class="line-number">229</span>
<span class="line-number">230</span>
<span class="line-number">231</span>
<span class="line-number">232</span>
<span class="line-number">233</span>
<span class="line-number">234</span>
<span class="line-number">235</span>
</pre></td><td class="code"><pre><code class="yaml"><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="c1"># Schema version of the content. Used by the SDK to apply the corresponding parsing rules.</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1.0.0</span>
</span><span class="line">
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="c1"># The client section used by GO SDK.</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="l-Scalar-Plain">client</span><span class="p-Indicator">:</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># Which organization does this application instance belong to? The value must be the name of an org</span>
</span><span class="line">  <span class="c1"># defined under &quot;organizations&quot;</span>
</span><span class="line">  <span class="l-Scalar-Plain">organization</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">org1</span>
</span><span class="line">
</span><span class="line">  <span class="l-Scalar-Plain">logging</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">level</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">info</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># Root of the MSP directories with keys and certs.</span>
</span><span class="line">  <span class="l-Scalar-Plain">cryptoconfig</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/ubuntu/.local/src/playfabric/first-network/crypto-config</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># Some SDKs support pluggable KV stores, the properties under &quot;credentialStore&quot;</span>
</span><span class="line">  <span class="c1"># are implementation specific</span>
</span><span class="line">  <span class="l-Scalar-Plain">credentialStore</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="c1"># [Optional]. Used by user store. Not needed if all credentials are embedded in configuration</span>
</span><span class="line">    <span class="c1"># and enrollments are performed elswhere.</span>
</span><span class="line">    <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="s">&quot;/tmp/state-store&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># [Optional]. Specific to the CryptoSuite implementation used by GO SDK. Software-based implementations</span>
</span><span class="line">    <span class="c1"># requiring a key store. PKCS#11 based implementations does not.</span>
</span><span class="line">    <span class="l-Scalar-Plain">cryptoStore</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="c1"># Specific to the underlying KeyValueStore that backs the crypto key store.</span>
</span><span class="line">      <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/tmp/msp</span>
</span><span class="line">
</span><span class="line">   <span class="c1"># BCCSP config for the client. Used by GO SDK.</span>
</span><span class="line">  <span class="l-Scalar-Plain">BCCSP</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">security</span><span class="p-Indicator">:</span>
</span><span class="line">     <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class="line">     <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">provider</span><span class="p-Indicator">:</span> <span class="s">&quot;SW&quot;</span>
</span><span class="line">     <span class="l-Scalar-Plain">hashAlgorithm</span><span class="p-Indicator">:</span> <span class="s">&quot;SHA2&quot;</span>
</span><span class="line">     <span class="l-Scalar-Plain">softVerify</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class="line">     <span class="l-Scalar-Plain">level</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">256</span>
</span><span class="line">
</span><span class="line">  <span class="l-Scalar-Plain">tlsCerts</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="c1"># [Optional]. Use system certificate pool when connecting to peers, orderers (for negotiating TLS) Default: false</span>
</span><span class="line">    <span class="l-Scalar-Plain">systemCertPool</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">
</span><span class="line"><span class="l-Scalar-Plain">channels</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="c1"># name of the channel</span>
</span><span class="line">  <span class="l-Scalar-Plain">mychannel</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="c1"># Required. list of peers from participating orgs</span>
</span><span class="line">    <span class="l-Scalar-Plain">peers</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">peer0.org1.example.com</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="c1"># [Optional]. will this peer be sent transaction proposals for endorsement? The peer must</span>
</span><span class="line">        <span class="c1"># have the chaincode installed. The app can also use this property to decide which peers</span>
</span><span class="line">        <span class="c1"># to send the chaincode install request. Default: true</span>
</span><span class="line">        <span class="l-Scalar-Plain">endorsingPeer</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class="line">
</span><span class="line">        <span class="c1"># [Optional]. will this peer be sent query proposals? The peer must have the chaincode</span>
</span><span class="line">        <span class="c1"># installed. The app can also use this property to decide which peers to send the</span>
</span><span class="line">        <span class="c1"># chaincode install request. Default: true</span>
</span><span class="line">        <span class="l-Scalar-Plain">chaincodeQuery</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class="line">
</span><span class="line">        <span class="c1"># [Optional]. will this peer be sent query proposals that do not require chaincodes, like</span>
</span><span class="line">        <span class="c1"># queryBlock(), queryTransaction(), etc. Default: true</span>
</span><span class="line">        <span class="l-Scalar-Plain">ledgerQuery</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class="line">
</span><span class="line">        <span class="c1"># [Optional]. will this peer be the target of the SDK&#39;s listener registration? All peers can</span>
</span><span class="line">        <span class="c1"># produce events but the app typically only needs to connect to one to listen to events.</span>
</span><span class="line">        <span class="c1"># Default: true</span>
</span><span class="line">        <span class="l-Scalar-Plain">eventSource</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># [Optional]. The application can use these options to perform channel operations like retrieving channel</span>
</span><span class="line">    <span class="c1"># config etc.</span>
</span><span class="line">    <span class="l-Scalar-Plain">policies</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="c1">#[Optional] options for retrieving channel configuration blocks</span>
</span><span class="line">      <span class="l-Scalar-Plain">queryChannelConfig</span><span class="p-Indicator">:</span>
</span><span class="line">        <span class="c1">#[Optional] min number of success responses (from targets/peers)</span>
</span><span class="line">        <span class="l-Scalar-Plain">minResponses</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span><span class="line">        <span class="c1">#[Optional] channel config will be retrieved for these number of random targets</span>
</span><span class="line">        <span class="l-Scalar-Plain">maxTargets</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
</span><span class="line">        <span class="c1">#[Optional] retry options for query config block</span>
</span><span class="line">        <span class="l-Scalar-Plain">retryOpts</span><span class="p-Indicator">:</span>
</span><span class="line">          <span class="c1">#[Optional] number of retry attempts</span>
</span><span class="line">          <span class="l-Scalar-Plain">attempts</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5</span>
</span><span class="line">          <span class="c1">#[Optional] the back off interval for the first retry attempt</span>
</span><span class="line">          <span class="l-Scalar-Plain">initialBackoff</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">500ms</span>
</span><span class="line">          <span class="c1">#[Optional] the maximum back off interval for any retry attempt</span>
</span><span class="line">          <span class="l-Scalar-Plain">maxBackoff</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5s</span>
</span><span class="line">          <span class="c1">#[Optional] he factor by which the initial back off period is exponentially incremented</span>
</span><span class="line">          <span class="l-Scalar-Plain">backoffFactor</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2.0</span>
</span><span class="line">
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="c1"># list of participating organizations in this network</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="l-Scalar-Plain">organizations</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">org1</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">mspid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Org1MSP</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># This org&#39;s MSP store (absolute path or relative to client.cryptoconfig)</span>
</span><span class="line">    <span class="l-Scalar-Plain">cryptoPath</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">peerOrganizations/org1.example.com/users/{username}@org1.example.com/msp</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">peers</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">peer0.org1.example.com</span>
</span><span class="line">      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">peer1.org1.example.com</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># [Optional]. Certificate Authorities issue certificates for identification purposes in a Fabric based</span>
</span><span class="line">    <span class="c1"># network. Typically certificates provisioning is done in a separate process outside of the</span>
</span><span class="line">    <span class="c1"># runtime network. Fabric-CA is a special certificate authority that provides a REST APIs for</span>
</span><span class="line">    <span class="c1"># dynamic certificate management (enroll, revoke, re-enroll). The following section is only for</span>
</span><span class="line">    <span class="c1"># Fabric-CA servers.</span>
</span><span class="line">    <span class="l-Scalar-Plain">certificateAuthorities</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ca.org1.example.com</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># the profile will contain public information about organizations other than the one it belongs to.</span>
</span><span class="line">  <span class="c1"># These are necessary information to make transaction lifecycles work, including MSP IDs and</span>
</span><span class="line">  <span class="c1"># peers with a public URL to send transaction proposals. The file will not contain private</span>
</span><span class="line">  <span class="c1"># information reserved for members of the organization, such as admin key and certificate,</span>
</span><span class="line">  <span class="c1"># fabric-ca registrar enroll ID and secret, etc.</span>
</span><span class="line">  <span class="l-Scalar-Plain">org2</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">mspid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Org2MSP</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># This org&#39;s MSP store (absolute path or relative to client.cryptoconfig)</span>
</span><span class="line">    <span class="l-Scalar-Plain">cryptoPath</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">peerOrganizations/org2.example.com/users/{username}@org2.example.com/msp</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">peers</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">peer0.org2.example.com</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">certificateAuthorities</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">ca.org2.example.com</span>
</span><span class="line">
</span><span class="line">  <span class="c1"># Orderer Org name</span>
</span><span class="line">  <span class="l-Scalar-Plain">ordererorg</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="c1"># Membership Service Provider ID for this organization</span>
</span><span class="line">      <span class="l-Scalar-Plain">mspID</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">OrdererMSP</span>
</span><span class="line">
</span><span class="line">      <span class="c1"># Needed to load users crypto keys and certs for this org (absolute path or relative to global crypto path, DEV mode)</span>
</span><span class="line">      <span class="l-Scalar-Plain">cryptoPath</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ordererOrganizations/example.com/users/{username}@example.com/msp</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="c1"># List of orderers to send transaction and channel create/update requests to. For the time</span>
</span><span class="line"><span class="c1"># being only one orderer is needed. If more than one is defined, which one get used by the</span>
</span><span class="line"><span class="c1"># SDK is implementation specific. Consult each SDK&#39;s documentation for its handling of orderers.</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="l-Scalar-Plain">orderers</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">orderer.example.com</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">orderer.example.com:7050</span>
</span><span class="line">
</span><span class="line">    <span class="c1"># these are standard properties defined by the gRPC library</span>
</span><span class="line">    <span class="c1"># they will be passed in as-is to gRPC client constructor</span>
</span><span class="line">    <span class="l-Scalar-Plain">grpcOptions</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">ssl-target-name-override</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">orderer.example.com</span>
</span><span class="line">      <span class="c1"># These parameters should be set in coordination with the keepalive policy on the server,</span>
</span><span class="line">      <span class="c1"># as incompatible settings can result in closing of connection.</span>
</span><span class="line">      <span class="c1"># When duration of the &#39;keep-alive-time&#39; is set to 0 or less the keep alive client parameters are disabled</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-time</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">20s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-permit</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="l-Scalar-Plain">fail-fast</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="c1"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span>
</span><span class="line">      <span class="l-Scalar-Plain">allow-insecure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">tlsCACerts</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="c1"># Certificate location absolute path</span>
</span><span class="line">      <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/ubuntu/repository/golang-repos/src/playfabric/first-network/crypto-config/ordererOrganizations/example.com/tlsca/tlsca.example.com-cert.pem</span>
</span><span class="line">
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="c1"># List of peers to send various requests to, including endorsement, query</span>
</span><span class="line"><span class="c1"># and event listener registration.</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="l-Scalar-Plain">peers</span><span class="p-Indicator">:</span>
</span><span class="line">  <span class="l-Scalar-Plain">peer0.org1.example.com</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="c1"># this URL is used to send endorsement and query requests</span>
</span><span class="line">    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer0.org1.example.com:7051</span>
</span><span class="line">    <span class="c1"># eventUrl is only needed when using eventhub (default is delivery service)</span>
</span><span class="line">    <span class="l-Scalar-Plain">eventUrl</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer0.org1.example.com:7053</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">grpcOptions</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">ssl-target-name-override</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer0.org1.example.com</span>
</span><span class="line">      <span class="c1"># These parameters should be set in coordination with the keepalive policy on the server,</span>
</span><span class="line">      <span class="c1"># as incompatible settings can result in closing of connection.</span>
</span><span class="line">      <span class="c1"># When duration of the &#39;keep-alive-time&#39; is set to 0 or less the keep alive client parameters are disabled</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-time</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">20s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-permit</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="l-Scalar-Plain">fail-fast</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="c1"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span>
</span><span class="line">      <span class="l-Scalar-Plain">allow-insecure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">tlsCACerts</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="c1"># Certificate location absolute path</span>
</span><span class="line">      <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/ubuntu/repository/golang-repos/src/playfabric/first-network/crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem</span>
</span><span class="line">
</span><span class="line">  <span class="l-Scalar-Plain">peer1.org1.example.com</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="c1"># this URL is used to send endorsement and query requests</span>
</span><span class="line">    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer1.org1.example.com:7151</span>
</span><span class="line">    <span class="c1"># eventUrl is only needed when using eventhub (default is delivery service)</span>
</span><span class="line">    <span class="l-Scalar-Plain">eventUrl</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer1.org1.example.com:7153</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">grpcOptions</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">ssl-target-name-override</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer1.org1.example.com</span>
</span><span class="line">      <span class="c1"># These parameters should be set in coordination with the keepalive policy on the server,</span>
</span><span class="line">      <span class="c1"># as incompatible settings can result in closing of connection.</span>
</span><span class="line">      <span class="c1"># When duration of the &#39;keep-alive-time&#39; is set to 0 or less the keep alive client parameters are disabled</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-time</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">20s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-permit</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="l-Scalar-Plain">fail-fast</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="c1"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span>
</span><span class="line">      <span class="l-Scalar-Plain">allow-insecure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">tlsCACerts</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="c1"># Certificate location absolute path</span>
</span><span class="line">      <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/ubuntu/repository/golang-repos/src/playfabric/first-network/crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem</span>
</span><span class="line">
</span><span class="line">  <span class="l-Scalar-Plain">peer0.org2.example.com</span><span class="p-Indicator">:</span>
</span><span class="line">    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer0.org2.example.com:8051</span>
</span><span class="line">    <span class="c1"># eventUrl is only needed when using eventhub (default is delivery service)</span>
</span><span class="line">    <span class="l-Scalar-Plain">eventUrl</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer0.org2.example.com:8053</span>
</span><span class="line">    <span class="l-Scalar-Plain">grpcOptions</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">ssl-target-name-override</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">peer0.org2.example.com</span>
</span><span class="line">      <span class="c1"># These parameters should be set in coordination with the keepalive policy on the server,</span>
</span><span class="line">      <span class="c1"># as incompatible settings can result in closing of connection.</span>
</span><span class="line">      <span class="c1"># When duration of the &#39;keep-alive-time&#39; is set to 0 or less the keep alive client parameters are disabled</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-time</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-timeout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">20s</span>
</span><span class="line">      <span class="l-Scalar-Plain">keep-alive-permit</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="l-Scalar-Plain">fail-fast</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">      <span class="c1"># allow-insecure will be taken into consideration if address has no protocol defined, if true then grpc or else grpcs</span>
</span><span class="line">      <span class="l-Scalar-Plain">allow-insecure</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span><span class="line">
</span><span class="line">    <span class="l-Scalar-Plain">tlsCACerts</span><span class="p-Indicator">:</span>
</span><span class="line">      <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/home/ubuntu/repository/golang-repos/src/playfabric/first-network/crypto-config/peerOrganizations/org2.example.com/tlsca/tlsca.org2.example.com-cert.pem</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="sdk">初始化sdk</h1>

<p>使用<code>github.com/hyperledger/fabric-sdk-go/pkg/core/config</code>包读取并解析配置文件,加载完成后即可初始化sdk</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="nx">configPath</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOPATH&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;/src/playfabric/config_e2e.yaml&quot;</span>
</span><span class="line"><span class="nx">configOpt</span> <span class="o">:=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">FromFile</span><span class="p">(</span><span class="nx">configPath</span><span class="p">)</span>
</span><span class="line"><span class="nx">sdk</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">configOpt</span><span class="p">)</span>
</span><span class="line"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">	<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">defer</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="section-1">初始化通道</h1>

<p>初始化channelContext及channel,至此初始化工作完成，可以操作chain code或者查询账本。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="c1">//prepare channel client context using client context</span>
</span><span class="line"><span class="nx">clientChannelContext</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">ChannelContext</span><span class="p">(</span><span class="s">&quot;mychannel&quot;</span><span class="p">,</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">WithUser</span><span class="p">(</span><span class="s">&quot;User1&quot;</span><span class="p">),</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">WithOrg</span><span class="p">(</span><span class="nx">orgName</span><span class="p">))</span>
</span><span class="line"><span class="c1">// Channel client is used to query and execute transactions (Org1 is default org)</span>
</span><span class="line"><span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">clientChannelContext</span><span class="p">)</span>
</span><span class="line"><span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to create new channel client: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span><span class="line">	<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="chaincode">操作ChainCode</h1>

<p>以官方example02的chain code（代币转移合约）为例:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="c1">// a =&gt; b转账2个代币</span>
</span><span class="line"><span class="kd">func</span> <span class="nx">executeCC</span><span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Client</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">ChaincodeID</span><span class="p">:</span> <span class="nx">ccID</span><span class="p">,</span> <span class="nx">Fcn</span><span class="p">:</span> <span class="s">&quot;invoke&quot;</span><span class="p">,</span> <span class="nx">Args</span><span class="p">:</span> <span class="nx">makeArgs</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">)},</span>
</span><span class="line">		<span class="nx">channel</span><span class="p">.</span><span class="nx">WithRetry</span><span class="p">(</span><span class="nx">retry</span><span class="p">.</span><span class="nx">DefaultChannelOpts</span><span class="p">))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;exe tx:&quot;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">TransactionID</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">err</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="c1">// 查询某个账户代币余额</span>
</span><span class="line"><span class="kd">func</span> <span class="nx">queryCC</span><span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span> <span class="nx">who</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">response</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">ChaincodeID</span><span class="p">:</span> <span class="nx">ccID</span><span class="p">,</span> <span class="nx">Fcn</span><span class="p">:</span> <span class="s">&quot;query&quot;</span><span class="p">,</span> <span class="nx">Args</span><span class="p">:</span> <span class="nx">makeArgs</span><span class="p">(</span><span class="nx">who</span><span class="p">)},</span>
</span><span class="line">		<span class="nx">channel</span><span class="p">.</span><span class="nx">WithRetry</span><span class="p">(</span><span class="nx">retry</span><span class="p">.</span><span class="nx">DefaultChannelOpts</span><span class="p">),</span>
</span><span class="line">		<span class="nx">channel</span><span class="p">.</span><span class="nx">WithTargetEndpoints</span><span class="p">(),</span>
</span><span class="line">	<span class="p">)</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;query tx:&quot;</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">TransactionID</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to query funds: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">Payload</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="section-2">完整示例</h1>

<p>完整示例很简单，包含代币转让及查询、底层账本查询（对应fabric1.1，BYFN示例网络）</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
</pre></td><td class="code"><pre><code class="go"><span class="line"><span class="kn">package</span> <span class="nx">main</span>
</span><span class="line">
</span><span class="line"><span class="kn">import</span> <span class="p">(</span>
</span><span class="line">	<span class="s">&quot;encoding/hex&quot;</span>
</span><span class="line">	<span class="s">&quot;fmt&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric-sdk-go/pkg/client/ledger&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric-sdk-go/third_party/github.com/hyperledger/fabric/protos/common&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric/common/util&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric-sdk-go/pkg/common/errors/retry&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric-sdk-go/pkg/client/channel&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric-sdk-go/pkg/core/config&quot;</span>
</span><span class="line">	<span class="s">&quot;github.com/hyperledger/fabric-sdk-go/pkg/fabsdk&quot;</span>
</span><span class="line">	<span class="s">&quot;os&quot;</span>
</span><span class="line"><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="kd">const</span> <span class="p">(</span>
</span><span class="line">	<span class="nx">channelID</span>      <span class="p">=</span> <span class="s">&quot;mychannel&quot;</span>
</span><span class="line">	<span class="nx">orgName</span>        <span class="p">=</span> <span class="s">&quot;Org1&quot;</span>
</span><span class="line">	<span class="nx">orgAdmin</span>       <span class="p">=</span> <span class="s">&quot;Admin&quot;</span>
</span><span class="line">	<span class="nx">ordererOrgName</span> <span class="p">=</span> <span class="s">&quot;OrdererOrg&quot;</span>
</span><span class="line">	<span class="nx">ccID</span>           <span class="p">=</span> <span class="s">&quot;mycc&quot;</span>
</span><span class="line"><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">queryLedgerExample</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">configPath</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOPATH&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;/src/playfabric/config_e2e.yaml&quot;</span>
</span><span class="line">	<span class="nx">configOpt</span> <span class="o">:=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">FromFile</span><span class="p">(</span><span class="nx">configPath</span><span class="p">)</span>
</span><span class="line">	<span class="nx">sdk</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">configOpt</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">defer</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</span><span class="line">	<span class="c1">//prepare channel client context using client context</span>
</span><span class="line">	<span class="nx">clientChannelContext</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">ChannelContext</span><span class="p">(</span><span class="nx">channelID</span><span class="p">,</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">WithUser</span><span class="p">(</span><span class="s">&quot;User1&quot;</span><span class="p">),</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">WithOrg</span><span class="p">(</span><span class="nx">orgName</span><span class="p">))</span>
</span><span class="line">	<span class="c1">// Channel client is used to query and execute transactions (Org1 is default org)</span>
</span><span class="line">	<span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ledger</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">clientChannelContext</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to create new channel client: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="nx">ledgerInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">QueryInfo</span><span class="p">()</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="nx">printBCI</span><span class="p">(</span><span class="nx">ledgerInfo</span><span class="p">.</span><span class="nx">BCI</span><span class="p">)</span>
</span><span class="line">	<span class="nx">block</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">QueryBlock</span><span class="p">(</span><span class="nx">ledgerInfo</span><span class="p">.</span><span class="nx">BCI</span><span class="p">.</span><span class="nx">GetHeight</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="nx">printBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span>
</span><span class="line">	<span class="c1">// txid := &quot;63abb9a2ae8e7f3f689498f4ccedef6001ab7902ba9dfe69e2c270a4f7ff1d4d&quot;</span>
</span><span class="line">	<span class="c1">// tx, err := client.QueryTransaction(fab.TransactionID(txid))</span>
</span><span class="line">	<span class="c1">// if err != nil {</span>
</span><span class="line">	<span class="c1">// 	fmt.Println(err)</span>
</span><span class="line">	<span class="c1">// 	os.Exit(1)</span>
</span><span class="line">	<span class="c1">// }</span>
</span><span class="line">	<span class="c1">// fmt.Println(&quot;Tx:&quot;, txid, &quot;payload:&quot;, hex.EncodeToString(tx.GetTransactionEnvelope().GetPayload()))</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">printBCI</span><span class="p">(</span><span class="nx">blk</span> <span class="o">*</span><span class="nx">common</span><span class="p">.</span><span class="nx">BlockchainInfo</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;block height:&quot;</span><span class="p">,</span> <span class="nx">blk</span><span class="p">.</span><span class="nx">GetHeight</span><span class="p">())</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;block hash:&quot;</span><span class="p">,</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">blk</span><span class="p">.</span><span class="nx">GetCurrentBlockHash</span><span class="p">()))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;block prevhash:&quot;</span><span class="p">,</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">blk</span><span class="p">.</span><span class="nx">GetPreviousBlockHash</span><span class="p">()))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;=====================================================&quot;</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">printBlock</span><span class="p">(</span><span class="nx">blk</span> <span class="o">*</span><span class="nx">common</span><span class="p">.</span><span class="nx">Block</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;BlockNO:%v\n&quot;</span><span class="p">,</span> <span class="nx">blk</span><span class="p">.</span><span class="nx">GetHeader</span><span class="p">().</span><span class="nx">GetNumber</span><span class="p">())</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;prevhash:&quot;</span><span class="p">,</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">blk</span><span class="p">.</span><span class="nx">GetHeader</span><span class="p">().</span><span class="nx">GetPreviousHash</span><span class="p">()))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;hash:&quot;</span><span class="p">,</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">EncodeToString</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">ComputeSHA256</span><span class="p">(</span><span class="nx">util</span><span class="p">.</span><span class="nx">ConcatenateBytes</span><span class="p">(</span><span class="nx">blk</span><span class="p">.</span><span class="nx">GetData</span><span class="p">().</span><span class="nx">GetData</span><span class="p">()</span><span class="o">...</span><span class="p">))))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;=====================================================&quot;</span><span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">configPath</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOPATH&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;/src/playfabric/config_e2e.yaml&quot;</span>
</span><span class="line">	<span class="nx">configOpt</span> <span class="o">:=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">FromFile</span><span class="p">(</span><span class="nx">configPath</span><span class="p">)</span>
</span><span class="line">	<span class="nx">sdk</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">configOpt</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">defer</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</span><span class="line">	<span class="c1">//prepare channel client context using client context</span>
</span><span class="line">	<span class="nx">clientChannelContext</span> <span class="o">:=</span> <span class="nx">sdk</span><span class="p">.</span><span class="nx">ChannelContext</span><span class="p">(</span><span class="nx">channelID</span><span class="p">,</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">WithUser</span><span class="p">(</span><span class="s">&quot;User1&quot;</span><span class="p">),</span> <span class="nx">fabsdk</span><span class="p">.</span><span class="nx">WithOrg</span><span class="p">(</span><span class="nx">orgName</span><span class="p">))</span>
</span><span class="line">	<span class="c1">// Channel client is used to query and execute transactions (Org1 is default org)</span>
</span><span class="line">	<span class="nx">client</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">channel</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">clientChannelContext</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to create new channel client: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">queryCC</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">queryCC</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">)))</span>
</span><span class="line">
</span><span class="line">	<span class="nx">executeCC</span><span class="p">(</span><span class="nx">client</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">queryCC</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">queryCC</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">)))</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">executeCC</span><span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Client</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">res</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">ChaincodeID</span><span class="p">:</span> <span class="nx">ccID</span><span class="p">,</span> <span class="nx">Fcn</span><span class="p">:</span> <span class="s">&quot;invoke&quot;</span><span class="p">,</span> <span class="nx">Args</span><span class="p">:</span> <span class="nx">makeArgs</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;2&quot;</span><span class="p">)},</span>
</span><span class="line">		<span class="nx">channel</span><span class="p">.</span><span class="nx">WithRetry</span><span class="p">(</span><span class="nx">retry</span><span class="p">.</span><span class="nx">DefaultChannelOpts</span><span class="p">))</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;exe tx:&quot;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">TransactionID</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">err</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">queryCC</span><span class="p">(</span><span class="nx">client</span> <span class="o">*</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Client</span><span class="p">,</span> <span class="nx">who</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span><span class="line">	<span class="nx">response</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">channel</span><span class="p">.</span><span class="nx">Request</span><span class="p">{</span><span class="nx">ChaincodeID</span><span class="p">:</span> <span class="nx">ccID</span><span class="p">,</span> <span class="nx">Fcn</span><span class="p">:</span> <span class="s">&quot;query&quot;</span><span class="p">,</span> <span class="nx">Args</span><span class="p">:</span> <span class="nx">makeArgs</span><span class="p">(</span><span class="nx">who</span><span class="p">)},</span>
</span><span class="line">		<span class="nx">channel</span><span class="p">.</span><span class="nx">WithRetry</span><span class="p">(</span><span class="nx">retry</span><span class="p">.</span><span class="nx">DefaultChannelOpts</span><span class="p">),</span>
</span><span class="line">		<span class="nx">channel</span><span class="p">.</span><span class="nx">WithTargetEndpoints</span><span class="p">(),</span>
</span><span class="line">	<span class="p">)</span>
</span><span class="line">	<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;query tx:&quot;</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">TransactionID</span><span class="p">)</span>
</span><span class="line">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Failed to query funds: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
</span><span class="line">		<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">Payload</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">func</span> <span class="nx">makeArgs</span><span class="p">(</span><span class="nx">args</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">[][]</span><span class="kt">byte</span> <span class="p">{</span>
</span><span class="line">	<span class="kd">var</span> <span class="nx">ccargs</span> <span class="p">[][]</span><span class="kt">byte</span>
</span><span class="line">	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">args</span> <span class="p">{</span>
</span><span class="line">		<span class="nx">ccargs</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">ccargs</span><span class="p">,</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">arg</span><span class="p">))</span>
</span><span class="line">	<span class="p">}</span>
</span><span class="line">	<span class="k">return</span> <span class="nx">ccargs</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h1 id="section-3">其他官方示例</h1>

<ul>
  <li><a href="https://github.com/hyperledger/fabric-sdk-go/tree/master/test/integration/e2e/end_to_end.go">E2E Test</a>: Basic example that uses SDK to query and execute transaction</li>
  <li><a href="https://github.com/hyperledger/fabric-sdk-go/tree/master/test/integration/pkg/client/ledger/ledger_queries_test.go">Ledger Query Test</a>: Basic example that uses SDK to query a channel’s underlying ledger</li>
  <li><a href="https://github.com/hyperledger/fabric-sdk-go/tree/master/test/integration/e2e/orgs/multiple_orgs_test.go">Multi Org Test</a>: An example that has multiple organisations involved in transaction</li>
  <li><a href="https://github.com/hyperledger/fabric-sdk-go/tree/master/test/integration/pkg/fabsdk/provider/sdk_provider_test.go">Dynamic Endorser Selection</a>: An example that uses dynamic endorser selection (based on chaincode policy)</li>
  <li><a href="https://github.com/hyperledger/fabric-sdk-go/tree/master/test/integration/e2e/pkcs11/e2e_test.go">E2E PKCS11 Test</a>: E2E Test using a PKCS11 crypto suite and configuration</li>
  <li><a href="https://github.com/securekey/fabric-examples/tree/master/fabric-cli/">CLI</a>: An example CLI for Fabric built with the Go SDK.</li>
</ul>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2018-07-25T06:23:59+00:00" pubdate data-updated="true">Jul 25<span>th</span>, 2018</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/blockchain/'>blockchain</a>


</div>
	
	<div class="comments"><a href="#disqus_thread">Comments</a></div>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
		
		
		<a class="addthis_button_tweet"></a>
		
		
		
	</div>
	
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2022

    Jason

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'qjpcpugithubio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://qjpcpu.github.io/blog/2018/07/25/hyperledger-fabricfu-wu-duan-kai-fa/';
        var disqus_url = 'http://qjpcpu.github.io/blog/2018/07/25/hyperledger-fabricfu-wu-duan-kai-fa/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>