---
layout: post
title: "在这里,读懂区块链"
date: 2018-09-18 15:08:00 +0800
comments: true
categories: blockchain 
---

读懂区块链——仅需这一篇。

<!-- more -->

* 目录
{:toc}

# 前言

撰写这篇文章的原因，一是想向对不了解区块链的同学介绍下这项技术，二也是借机进行一次知识梳理,所以，有理解错误的地方，也希望读者不吝指正。

**对于读者群**:

因为有的读者是非技术类的，所以我将内容拆分成入门和进阶两部分,在入门篇里我尽量不涉及计算机技术术语，其细节我会放到进阶篇；同时，我也不希望进阶篇变成学术论文，所以进阶篇里会从逻辑层面解释原理，不会涉及数学公式,我并不希望读者睡着了。

所以,不想了解技术细节的同学，读完入门篇就够了;而对于有进一步探索欲望的同学，进阶篇也有足够指向作用了。

**链种**:

目前区块链分为公链、联盟链、私链，本文主要介绍公链，并稍微提及联盟链，不会涉及私链。

废话不多说, let's start now.

# 入门篇

## 什么是区块链?

我想每个人第一次听到区块链这三个字的时候，第一反应都是本能地问出:区块链是什么? **What***永远是人类认识事物的第一步,那么怎么回答这个问题呢。其实无论是回答什么"去中心化的信任机制"还是"分布式账本"，我相信听众脸上懵比的问号只会更大。所以我们尝试还原区块链产生的场景，了解这项技术产生的背景，从而回答它是什么。

### 场景

Clark是居住在大都会一个普通小伙子，他在星球日报勤勤恳恳地工作，把他辛苦挣来的钱都存入大都会银行，这家银行由大银行家Luthor筹建，是大都会最大最安全的银行,大都会居住的人们都喜欢把他们的资金存入这家银行，他们都信任这家银行，祖祖辈辈都离不开这家银行,Luthor确实也将银行经营得很好。

然而，不久后大都会发生了外星人入侵事件，所幸的是大都会人们还是挺过了这场灾难。不过大都会遭受了巨大的经济损失，经济发生萧条。这其中蒙受损失的，自然也包括大都会银行，Luthor为了维护自身的利益，不顾一切开始大量增发货币。这下Clark发现自己本就不多的存款变得一文不值，更为雪上加霜的是，灾后他去查自己的银行账户的时候，发现自己账户余额为零,而Luthor给Clark的解释是，入侵事件毁坏了银行部分数据，因而luthor无法恢复clark的财产，甚至也拒绝支付赔偿。

Clark听到这一切，无助地瘫倒在地，口中喃喃:这可是我攒来娶Louis的老本啊...

![clarkVSluthor](https://raw.githubusercontent.com/qjpcpu/qjpcpu.github.com/master/images/clark-luthor.jpg)

### 先找到问题

那么，Clark遇到的问题所在在哪儿呢？Clark找到好友Bruce,助他度过了当前难关，但是还是不知道怎么在同样情况下避免财务危机。这个时候，Bruce一针见血地指出了问题所在:

**中心化信任危机**

Luthor所代表的大都会银行，广义来讲就是中心化的权威机构。所有中心机构的用户，都是基于信任将资金托管给该机构，但是信任是不可靠的，一旦发生信任危机，中心化机构可以打破信任，对于银行来说可以不受限制地增发货币甚至直接侵吞私有财产。你可能会说有法律保护，但是这个时候其实是国家在为这个机构背书，国家机器充当了这个隐形的中心化信任载体。尽管国家违约成本比较高，但只要翻翻历史书，就会发现这样的案例也不在少数。

### 分析问题

既然找到问题所在，那么应该怎么设计新的解决方案呢？

#### 1. 去除中心化机构

如果问题出在中心化机构，那么很自然的就需要在我们的解决方案里移除对中心化机构的信任依赖。

那么我们就每个人都持有一个账本，并且每个账本初始数据都一模一样;比如是这样的一个账本:

```
Bruce inital 1
Clark inital 10000
...
```

一旦发生转账，比如Bruce要给Clark转账200，那么所有人都在账本上写上一句`Bruce transfer 200 to Clark`。 那么账本就变成了

```
Bruce inital 1
Clark inital 10000
...
Bruce transfer 200 to Clark
```

此时，如果我们想知道Clark的账户余额，只需要把和Clark相关的记账账目汇总即可得到`Balance(Clark) = 1 + 200 = 201`,这个结果不容任何人抵赖，因为你问大街上任意一个人，只要他打开他的账本，按同样的方法计算都可以得出Clark账户余额是201这个结果。

#### 2. 信任问题

去除中心化之后，似乎我们的问题解决了。因为就算再次发生入侵，只要不是所有人的账本都损坏了，那么我们就可以找账本完好的人把之前的账目抄下来恢复自己的账本，从而恢复所有人的资产记录。

但是实际上没有那么简单，如果有人冒充Bruce要求转账给Clark,那么Bruce就在不知情的情况下被盗取了财产。所以，我们借鉴了现实生活中签名的办法，要求Bruce在转账的时候必须附加自己的签名，然后将这笔转账和签名一起广播出去。这样大家记账的时候就能验证，的确是Bruce本人要求的转账。

![bruce-sign](https://raw.githubusercontent.com/qjpcpu/qjpcpu.github.com/master/images/bruce-sign.png)

#### 3. 记账权

在我们新的解决方案里，我们需要交易发起人广播给其他所有记账人，实际上，这个广播不可能一瞬间将交易发给所有人。这个广播系统可以这样理解，假设我们都使用蓝牙协议作为通信基础，这个系统里每个人都使用蓝牙和身边十来个人保持连接，同理这些人和各自身边的人保持连接，这样所有人构成一个互联的网状结构。

![blockchain](https://raw.githubusercontent.com/qjpcpu/qjpcpu.github.com/master/images/bluetooth-p2p.png)

因为交易信息传播有时间延迟，所以，同一时刻，系统里每个人收到的记账请求是不一样的。那么，我们一开始设计的所有人一起记账就行不通了，因为这样写到账本里的账目就不同了。为了大家写入同样的数据，必须能一起协调出同一的账目，然后写入。因为现在是一个大民主的社群，必须有一种投票机制选出一个记账人，这个记账人复制整理这段时间内收到的记账请求，并把这些账目一起写入账本;我们称之为争夺记账权。

那么，怎么设计这个记账权争夺机制呢？

* 首先必须要公平，不能因为某个记账人的社会地位高就能够拥有记账权；因为这样就会再次导致记账中心化，从而使得我们这个去中心化的解决方案失效
* 机制必须透明，机制的透明是对公平性的验证，我们的解决方案里必须能够让所有人能够验证这个公平性是否属实
* 筛选性，既然是记账权的争夺，这个机制必然具有强烈的优胜劣汰性质，否则达不到筛选出冠军的目的
* 冠军身份易于验证，就如同一场长跑，争夺冠军是非常艰难的，但是一旦夺得胜利，我们能一眼分辨出谁是冠军——谁戴着奖牌谁是冠军

明确了这个设计需求，我们留到求解问题时再进行解答。

但是基于我们这个设计，又带来了新的问题，如果记一次帐这么费劲，那肯定最后没人愿意记账了。中国有句老话说得好: 无利不起早，现实生活中大部分人的行为都是趋利的。所以，我们这个解决方案里，还差最后一环——经济激励。

如果我们这个解决方案里，大家约定，一旦某个天选之子夺得了记账权并成功记账，那么就给予他额外现金奖励，这个奖励足够补偿他这次辛苦记账的付出,这样，整个流程似乎就理顺了。

### 求解问题

在开始执行求解前，我们先复盘一下我们的思路，看看是否有思路不通畅的地方，防止出现逻辑漏洞。

![blockchain](https://raw.githubusercontent.com/qjpcpu/qjpcpu.github.com/master/images/thoughts-flow.jpeg)

这是一条由问题驱动的推导型思路，主要是为了解决我们发现的中心化问题，在提出新的解决方案并解决新的衍生问题，主体上看来没有大的疏漏。

下面我们开始来求解遗留的记账争夺问题。

因为大都会市民极其不擅长数学，所以，我们使用求余来作为这场争夺的题目。比如每次记账，要求大家求解`x % 7 = 3`满足这个等式的`x`,因为大家数学很差，所以大家不得不一个一个数去尝试，当某个幸运儿最先发现`10 % 7 = 3`时，他就获取了记账权，而其他人将`x=10`带进算式很容易验算出这是符合条件的一个求解，所以大家也就表示认同，同时也认可了他的记账。于是所有人复制他记下的账目，并开始收集新的交易流水，准备下一次记账。


最后，我们将我们这个解决方案称之为"区块链"，这个解决方案里的很多做法其实就是真实区块链技术的简化版:

* 区块链; 我们的记账笔记薄就是一条区块链，这里面从前往后记录了所有人的所有账目流水，后面的账目对前面的账目有依赖关系
* 区块; 账本的每一页，可以称之为一个区块，页码可以认为是区块前后的索引关系
* 交易; 账本每一页的每一条都是一笔交易，这个交易可以是一笔简单转账，也可以是一次协定
* 数字签名; 还记得我们要求每笔交易发送时必须附加自己的签名吗？在数字世界里，我们必须附加自己的[数字签名](https://zh.wikipedia.org/wiki/%E6%95%B8%E4%BD%8D%E7%B0%BD%E7%AB%A0),这个签名甚至比真实世界的签名更可靠，它基于密码学，不可伪造且能唯一证明你的授权
* 挖矿; 我们的争夺记账权的过程，和矿工付出辛劳挖矿非常相似，所以也称之为挖矿了。不过真实的区块链挖矿使用的不是求余这么简单的运算，而是反解hash前缀0的暴力运算
* 矿工; 从事争夺记账权的节点(人)
* 虚拟货币; 不管是矿工挖矿得到的额外经济奖励，还是账本上记录的基本代数资产，都是这条区块链上的虚拟货币；比如比特币区块链上的虚拟货币就是BTC, 以太坊上的火币就是ETH
* 共识机制; 争夺记账权的机制就是共识机制，因为争夺机制的差异，目前有PoW,PoS等;目前久经考验的共识机制是PoW,我们大都会区块链的共识，也使得矿工付出大量脑力劳动，所以也可以称之为一种PoW

### 什么是区块链

回到最初的问题，什么是区块链: 

**区块链是在对等且不受信环境下, 保证群体协作达成共识的一种社群机制**



## 区块链能做什么?

tip: 金融、游戏

## 区块链不能做什么?

tip: 真瓶装假酒

## 区块链生态

### 智能合约

### SDK

### 钱包

### 交易所

### 矿工节点

## 几条著名公链

### BTC

### Ethereum

### ONT

### EOS

### BCH

### IPFS

# 进阶篇

## UTXO/Balance两种模型
刷银行卡、现实纸币

## 共识机制

### POW

### POS

### DPOS

## 51%与双花

## P2P

## 联盟链

# 参考文献
